!function(e,t){function n(e){e.toggleClass("open")}var s=function(e){var t,n=e.createElement("details");if(!("open"in n))return!1;var s=e.body||function(){var n=e.documentElement;return t=!0,n.insertBefore(e.createElement("body"),n.firstElementChild||n.firstChild)}();n.innerHTML="<summary>a</summary>b",n.style.display="block",s.appendChild(n);var l=n.offsetHeight;return n.open=!0,l=l!==n.offsetHeight,s.removeChild(n),t&&s.parentNode.removeChild(s),l}(e);t.fn.details=function(){return s?this:this.each(function(){var e=t(this),s=t("summary",e).first();s.prop("tabIndex",0),s.on("keydown",function(t){if(32===t.keyCode||13===t.keyCode)return n(e),!1}),s.on("click",function(){s.focus(),n(e)})})}}(document,jQuery),define("discourse/plugins/discourse-details/initializers/apply-details",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";function n(e){e.decorateCooked(function(e){return $("details",e).details()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}}),e.modifyClass("controller:composer",{actions:{insertDetails:function(){this.get("toolbarEvent").applySurround('\n[details="'+I18n.t("composer.details_title")+'"]\n',"\n[/details]\n","details_text",{multiline:!1})}}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"apply-details",initialize:function(){(0,t.withPluginApi)("0.8.7",n)}}}),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["exports"],function(e){"use strict";function t(e){e.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),e.registerPlugin(function(e){e.block.bbcode.ruler.push("details",n)})}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=t;var n={tag:"details",before:function(e,t){var n=t.attrs;e.push("bbcode_open","details",1),e.push("bbcode_open","summary",1),e.push("text","",0).content=n._default||"",e.push("bbcode_close","summary",-1)},after:function(e){e.push("bbcode_close","details",-1)}}}),function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};clearTimeout(this.timeout);var s=moment().utc(),i=n.time?n.date+" "+n.time:n.date,o=void 0,a=void 0;a=n.time?n.displayedTimezone||moment.tz.guess():n.displayedTimezone||n.timezone||moment.tz.guess(),(o=n.timezone?l(i,n.timezone):moment.utc(i))<s&&(n.recurring?o=u(o,n.recurring):e.addClass("past"));var c=o.tz(a),h=p(c.clone(),a,n),v=d(h),b=m(h),g=r(c,a,n);e.html(f).attr("aria-label",v).attr("data-html-tooltip",'<div class="locale-dates-previews">'+b+"</div>").addClass("cooked-date").find(".relative-time").text(g),this.timeout=setTimeout(function(){return t(e,n)},1e4)}function n(e){return e.replace("_"," ").replace("Etc/","").split("/")}function s(e){var t=n(e);return t[1]||t[0]}function l(e,t){return moment.tz(e,t).utc()}function i(e,t){var n=I18n.t("discourse_local_dates.relative_dates."+t,{time:"LT"});return e?n.split("LT").map(function(e){return"["+e+"]"}).join("LT"):"["+n.replace(" LT","")+"]"}function o(e){return{sameDay:i(e,"today"),nextDay:i(e,"tomorrow"),lastDay:i(e,"yesterday"),sameElse:"L"}}function a(e,t){return moment.tz(e).utcOffset()===moment.tz(t).utcOffset()}function r(e,t,l){var i=a(t,moment.tz.guess()),r=e.isBetween(moment().subtract(2,"days"),moment().add(1,"days").endOf("day"));return l.calendar&&r?i?e=l.time?e.calendar(null,o(l.time)):e.calendar(null,o(null)):(e=e.format(l.format),e=e.replace("TZ",""),e=e+" ("+s(t)+")"):l.time?(e=e.format(l.format),l.displayedTimezone&&!i?(e=e.replace("TZ",""),e=e+" ("+s(t)+")"):e=e.replace("TZ",n(t).join(": "))):(e=e.format(l.format),i?e=e.replace("TZ",s(t)):(e=e.replace("TZ",""),e=e+" ("+s(t)+")")),e}function u(e,t){var n=t.split("."),s=parseInt(n[0],10),l=n[1],i=moment().diff(e,l),o=Math.ceil(i+s);return e.add(o,l)}function c(e,t){return e.tz(t).format("LLL")+" → "+e.add(24,"hours").tz(t).format("LLL")}function p(e,t,n){var s=[],l=moment.tz.guess(),i=n.timezones.filter(function(e){return e!==l});return s.push({timezone:l,current:!0,dateTime:n.time?e.tz(l).format("LLL"):c(e,l)}),n.timezone&&t===l&&n.timezone!==t&&!a(t,n.timezone)&&i.unshift(n.timezone),i.filter(function(e){return e}).forEach(function(i){a(i,t)||(a(i,l)&&(i=l),s.push({timezone:i,dateTime:n.time?e.tz(i).format("LLL"):c(e,i)}))}),s.length||s.push({timezone:"Etc/UTC",dateTime:n.time?e.tz("Etc/UTC").format("LLL"):c(e,"Etc/UTC")}),_.uniq(s,"timezone")}function d(e){return e.map(function(e){var t=s(e.timezone);return e.dateTime.match(/TZ/)?e.dateTime.replace(/TZ/,t):t+" "+e.dateTime}).join(", ")}function m(t){return t.map(function(t){var n=e(h);return t.current&&n.addClass("current"),n.find(".timezone").text(s(t.timezone)),n.find(".date-time").text(t.dateTime),n[0].outerHTML}).join("")}var f='\n    <span>\n      <svg class="fa d-icon d-icon-globe-americas svg-icon" xmlns="http://www.w3.org/2000/svg">\n        <use xlink:href="#globe-americas"></use>\n      </svg>\n      <span class="relative-time"></span>\n    </span>\n  ',h="\n    <div class='preview'>\n      <span class='timezone'></span>\n      <span class='date-time'></span>\n    </div>\n  ";e.fn.applyLocalDates=function(){return this.each(function(){var n=e(this),s={};s.time=n.attr("data-time"),s.date=n.attr("data-date"),s.recurring=n.attr("data-recurring"),s.timezones=(n.attr("data-timezones")||Discourse.SiteSettings.discourse_local_dates_default_timezones||"Etc/UTC").split("|"),s.timezone=n.attr("data-timezone"),s.calendar="on"===(n.attr("data-calendar")||"on"),s.displayedTimezone=n.attr("data-displayed-timezone"),s.format=n.attr("data-format")||(s.time?"LLL":"LL"),t(n,s)})}}(jQuery),define("discourse/plugins/discourse-local-dates/discourse/components/discourse-local-dates-create-form",["exports","ember-addons/ember-computed-decorators"],function(e,t){"use strict";function n(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0});var s,l,i,o,a;e.default=Ember.Component.extend((s=(0,t.observes)("date","time","toDate","toTime"),l=(0,t.default)("formats"),i=(0,t.default)(),o=(0,t.default)("advancedMode"),a={timeFormat:"HH:mm:ss",dateFormat:"YYYY-MM-DD",dateTimeFormat:"YYYY-MM-DD HH:mm:ss",config:null,date:null,toDate:null,time:null,toTime:null,format:null,formats:null,recurring:null,advancedMode:!1,isValid:!0,init:function(){this._super(),this.set("date",moment().format(this.dateFormat)),this.set("timezones",[]),this.set("formats",(this.siteSettings.discourse_local_dates_default_formats||"").split("|").filter(function(e){return e}))},_resetFormValidity:function(){this.set("isValid",!0)},currentUserTimezone:function(){return moment.tz.guess()},previewedFormats:function(e){return e.map(function(e){return{format:e,preview:moment().format(e)}})},recurringOptions:function(){return[{name:"Every day",id:"1.days"},{name:"Every week",id:"1.weeks"},{name:"Every two weeks",id:"2.weeks"},{name:"Every month",id:"1.months"},{name:"Every two months",id:"2.months"},{name:"Every three months",id:"3.months"},{name:"Every six months",id:"6.months"},{name:"Every year",id:"1.years"}]},allTimezones:function(){return"en"!==moment.locale()&&"function"==typeof moment.tz.localizedNames?moment.tz.localizedNames():moment.tz.names()},getConfig:function(e){var t=e&&"end"===e,n=t?this.get("toTime"):this.get("time"),s=t?this.get("toDate"):this.get("date");t&&n&&!s&&(s=moment().format(this.dateFormat));var l=this.get("recurring"),i=this.get("format"),o=this.get("timezones"),a=!n,r=this.get("currentUserTimezone"),u=void 0;u=a?t?moment.tz(s,r).endOf("day"):moment.tz(s,r):moment.tz(s+" "+n,r);var c={date:u.format(this.dateFormat),dateTime:u,recurring:l,format:i,timezones:o,timezone:r};return a||(c.time=u.format(this.timeFormat)),a&&(c.displayedTimezone=this.get("currentUserTimezone")),a&&this.get("formats").includes(i)&&(c.format="LL"),c},_generateDateMarkup:function(e){var t="[date="+e.date;return e.time&&(t+=" time="+e.time+" "),e.format&&e.format.length&&(t+=' format="'+e.format+'" '),e.timezone&&(t+=' timezone="'+e.timezone+'"'),e.timezones&&e.timezones.length&&(t+=' timezones="'+e.timezones.join("|")+'"'),e.recurring&&(t+=' recurring="'+e.recurring+'"'),t+="]"},valid:function(e){var t=this.getConfig(e?"start":null);if(!t.dateTime||!t.dateTime.isValid())return this.set("isValid",!1),!1;if(e){var n=this.getConfig("end");if(!n.dateTime||!n.dateTime.isValid()||n.dateTime.diff(t.dateTime)<0)return this.set("isValid",!1),!1}return this.set("isValid",!0),!0},toggleModeBtnLabel:function(e){return e?"discourse_local_dates.create.form.simple_mode":"discourse_local_dates.create.form.advanced_mode"},actions:{advancedMode:function(){this.toggleProperty("advancedMode")},save:function(){var e=this.get("date")&&(this.get("toDate")||this.get("toTime"));if(this.valid(e)){this._closeModal();var t=this._generateDateMarkup(this.getConfig(e?"start":null));e&&(t+=" → ",t+=this._generateDateMarkup(this.getConfig("end"))),this.get("toolbarEvent").addText(t)}},fillFormat:function(e){this.set("format",e)},cancel:function(){this._closeModal()}},_closeModal:function(){Discourse.__container__.lookup("controller:composer").send("closeModal")}},n(a,"_resetFormValidity",[s],Object.getOwnPropertyDescriptor(a,"_resetFormValidity"),a),n(a,"currentUserTimezone",[t.default],Object.getOwnPropertyDescriptor(a,"currentUserTimezone"),a),n(a,"previewedFormats",[l],Object.getOwnPropertyDescriptor(a,"previewedFormats"),a),n(a,"recurringOptions",[t.default],Object.getOwnPropertyDescriptor(a,"recurringOptions"),a),n(a,"allTimezones",[i],Object.getOwnPropertyDescriptor(a,"allTimezones"),a),n(a,"toggleModeBtnLabel",[o],Object.getOwnPropertyDescriptor(a,"toggleModeBtnLabel"),a),a))}),Ember.TEMPLATES["javascripts/components/discourse-local-dates-create-form"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["previewedFormat"],"statements":[[4,"d-modal-body",null,[["title","subtitle","class","style"],["discourse_local_dates.create.modal_title","discourse_local_dates.create.modal_subtitle","discourse-local-dates-create-modal","overflow: auto"]],{"statements":[[0,"\\n  "],[7,"div"],[11,"class","form"],[9],[0,"\\n    "],[7,"div"],[11,"class","date-time-configuration"],[9],[0,"\\n      "],[7,"div"],[11,"class","range"],[9],[0,"\\n        "],[7,"div"],[11,"class","from"],[9],[0,"\\n          "],[7,"div"],[11,"class","control-group date"],[9],[0,"\\n            "],[7,"label"],[11,"class","control-label"],[9],[0,"\\n              "],[1,[27,"i18n",["discourse_local_dates.create.form.date_title"],null],false],[0,"\\n            "],[10],[0,"\\n            "],[7,"div"],[11,"class","controls"],[9],[0,"\\n              "],[1,[27,"date-picker",null,[["class","value","defaultDate"],["date-input",[23,["date"]],"DD-MM-YYYY"]]],false],[0,"\\n            "],[10],[0,"\\n          "],[10],[0,"\\n\\n          "],[7,"div"],[11,"class","control-group time"],[9],[0,"\\n            "],[7,"label"],[11,"class","control-label"],[9],[0,"\\n              "],[1,[27,"i18n",["discourse_local_dates.create.form.time_title"],null],false],[0,"\\n            "],[10],[0,"\\n            "],[7,"div"],[11,"class","controls"],[9],[0,"\\n              "],[1,[27,"input",null,[["type","value","class"],["time",[23,["time"]],"time-input"]]],false],[0,"\\n            "],[10],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n\\n        "],[7,"span"],[11,"class","to-indicator"],[9],[7,"span"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.to"],null],false],[10],[10],[0,"\\n\\n        "],[7,"div"],[11,"class","to"],[9],[0,"\\n          "],[7,"div"],[11,"class","control-group date"],[9],[0,"\\n            "],[7,"label"],[11,"class","control-label"],[9],[0,"\\n              "],[1,[27,"i18n",["discourse_local_dates.create.form.date_title"],null],false],[0,"\\n            "],[10],[0,"\\n            "],[7,"div"],[11,"class","controls"],[9],[0,"\\n              "],[1,[27,"date-picker",null,[["class","value","defaultDate"],["date-input",[23,["toDate"]],"DD-MM-YYYY"]]],false],[0,"\\n            "],[10],[0,"\\n          "],[10],[0,"\\n\\n          "],[7,"div"],[11,"class","control-group time"],[9],[0,"\\n            "],[7,"label"],[11,"class","control-label"],[9],[0,"\\n              "],[1,[27,"i18n",["discourse_local_dates.create.form.time_title"],null],false],[0,"\\n            "],[10],[0,"\\n            "],[7,"div"],[11,"class","controls"],[9],[0,"\\n              "],[1,[27,"input",null,[["type","value","class"],["time",[23,["toTime"]],"time-input"]]],false],[0,"\\n            "],[10],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n      "],[10],[0,"\\n\\n      "],[7,"span"],[11,"class","preview"],[9],[1,[21,"currentUserTimezone"],false],[10],[0,"\\n    "],[10],[0,"\\n\\n"],[4,"unless",[[23,["isValid"]]],null,{"statements":[[0,"      "],[7,"span"],[11,"class","validation-error"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.invalid_date"],null],false],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n    "],[7,"div"],[11,"class","control-group recurrence"],[9],[0,"\\n      "],[7,"label"],[11,"class","control-label"],[9],[0,"\\n        "],[1,[27,"i18n",["discourse_local_dates.create.form.recurring_title"],null],false],[0,"\\n      "],[10],[0,"\\n"],[4,"if",[[23,["advancedMode"]]],null,{"statements":[[0,"        "],[7,"p"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.recurring_description"],null],true],[10],[0,"\\n"]],"parameters":[]},null],[0,"      "],[7,"div"],[11,"class","controls"],[9],[0,"\\n        "],[1,[27,"combo-box",null,[["content","class","value","none"],[[23,["recurringOptions"]],"recurrence-input",[23,["recurring"]],"discourse_local_dates.create.form.recurring_none"]]],false],[0,"\\n      "],[10],[0,"\\n    "],[10],[0,"\\n\\n"],[4,"if",[[23,["advancedMode"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","advanced-options"],[9],[0,"\\n        "],[7,"div"],[11,"class","control-group format"],[9],[0,"\\n          "],[7,"label"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.format_title"],null],false],[10],[0,"\\n          "],[7,"p"],[9],[0,"\\n            "],[1,[27,"i18n",["discourse_local_dates.create.form.format_description"],null],false],[0,"\\n            "],[7,"a"],[11,"target","_blank"],[11,"rel","noopener"],[11,"href","https://momentjs.com/docs/#/parsing/string-format/"],[9],[0,"\\n              "],[1,[27,"d-icon",["question-circle"],null],false],[0,"\\n            "],[10],[0,"\\n          "],[10],[0,"\\n          "],[7,"div"],[11,"class","controls"],[9],[0,"\\n            "],[1,[27,"text-field",null,[["value","class"],[[23,["format"]],"format-input"]]],false],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n        "],[7,"div"],[11,"class","control-group"],[9],[0,"\\n          "],[7,"ul"],[11,"class","formats"],[9],[0,"\\n"],[4,"each",[[23,["previewedFormats"]]],null,{"statements":[[0,"              "],[7,"li"],[11,"class","format"],[9],[0,"\\n                "],[7,"a"],[11,"class","moment-format"],[11,"href",""],[9],[0,"\\n                  "],[1,[22,1,["format"]],false],[0,"\\n                "],[3,"action",[[22,0,[]],"fillFormat",[22,1,["format"]]]],[10],[0,"\\n                "],[7,"span"],[11,"class","previewed-format"],[9],[0,"\\n                  "],[1,[22,1,["preview"]],false],[0,"\\n                "],[10],[0,"\\n              "],[10],[0,"\\n"]],"parameters":[1]},null],[0,"          "],[10],[0,"\\n        "],[10],[0,"\\n\\n        "],[7,"div"],[11,"class","control-group timezones"],[9],[0,"\\n          "],[7,"label"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.timezones_title"],null],false],[10],[0,"\\n          "],[7,"p"],[9],[1,[27,"i18n",["discourse_local_dates.create.form.timezones_description"],null],false],[10],[0,"\\n          "],[7,"div"],[11,"class","controls"],[9],[0,"\\n            "],[1,[27,"multi-select",null,[["class","allowAny","maximum","content","values"],["timezones-input",false,5,[23,["allTimezones"]],[23,["timezones"]]]]],false],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null],[0,"  "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div"],[11,"class","modal-footer discourse-local-dates-create-modal-footer"],[9],[0,"\\n"],[4,"if",[[23,["isValid"]]],null,{"statements":[[0,"    "],[1,[27,"d-button",null,[["class","action","label"],["btn btn-default",[27,"action",[[22,0,[]],"save"],null],"discourse_local_dates.create.form.insert"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n  "],[7,"a"],[11,"class","cancel-action"],[11,"href",""],[9],[0,"\\n    "],[1,[27,"i18n",["cancel"],null],false],[0,"\\n  "],[3,"action",[[22,0,[]],"cancel"]],[10],[0,"\\n\\n  "],[1,[27,"d-button",null,[["class","action","icon","label"],["btn-default advanced-mode-btn",[27,"action",[[22,0,[]],"advancedMode"],null],"cog",[23,["toggleModeBtnLabel"]]]]],false],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/components/discourse-local-dates-create-form"}}),Ember.TEMPLATES["javascripts/modal/discourse-local-dates-create-modal"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[27,"discourse-local-dates-create-form",null,[["config","toolbarEvent"],[[23,["config"]],[23,["toolbarEvent"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/modal/discourse-local-dates-create-modal"}}),define("discourse/plugins/discourse-local-dates/initializers/discourse-local-dates",["exports","discourse/lib/plugin-api","discourse/lib/show-modal"],function(e,t,n){"use strict";function s(e){e.decorateCooked(function(e){$(".discourse-local-date",e).applyLocalDates()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDiscourseLocalDate",icon:"globe",label:"discourse_local_dates.title"}}),e.modifyClass("controller:composer",{actions:{insertDiscourseLocalDate:function(){(0,n.default)("discourse-local-dates-create-modal").setProperties({toolbarEvent:this.get("toolbarEvent")})}}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"discourse-local-dates",initialize:function(e){e.lookup("site-settings:main").discourse_local_dates_enabled&&(0,t.withPluginApi)("0.8.8",s)}}}),define("discourse/plugins/discourse-local-dates/lib/discourse-markdown/discourse-local-dates",["exports","pretty-text/engines/discourse-markdown/bbcode-block"],function(e,t){"use strict";function n(e,n,l){var i=void 0,o={date:null,time:null,timezone:null,format:null,timezones:null,displayedTimezone:null},a=(0,t.parseBBCodeTag)("[date date"+n[1]+"]",0,n[1].length+11);if(o.date=a.attrs.date,o.format=a.attrs.format,o.calendar=a.attrs.calendar,o.time=a.attrs.time,o.timezone=a.attrs.timezone,o.recurring=a.attrs.recurring,o.timezones=a.attrs.timezones,o.displayedTimezone=a.attrs.displayedTimezone,i=new l.Token("span_open","span",1),i.attrs=[["data-date",l.md.utils.escapeHtml(o.date)]],!o.date.match(/\d{4}-\d{2}-\d{2}/))return void s(e,l,moment.invalid().format());if(o.time&&!o.time.match(/\d{2}:\d{2}(?::\d{2})?/))return void s(e,l,moment.invalid().format());var r=o.date;if(o.time&&(i.attrs.push(["data-time",l.md.utils.escapeHtml(o.time)]),r=r+" "+o.time),!moment(r).isValid())return void s(e,l,moment.invalid().format());if(i.attrs.push(["class","discourse-local-date"]),o.format&&i.attrs.push(["data-format",l.md.utils.escapeHtml(o.format)]),o.calendar&&i.attrs.push(["data-calendar",l.md.utils.escapeHtml(o.calendar)]),o.displayedTimezone&&moment.tz.names().includes(o.displayedTimezone)&&i.attrs.push(["data-displayed-timezone",l.md.utils.escapeHtml(o.displayedTimezone)]),o.timezones){var u=o.timezones.split("|").filter(function(e){return moment.tz.names().includes(e)});i.attrs.push(["data-timezones",l.md.utils.escapeHtml(u.join("|"))])}o.timezone&&moment.tz.names().includes(o.timezone)?(i.attrs.push(["data-timezone",l.md.utils.escapeHtml(o.timezone)]),r=moment.tz(r,o.timezone)):r=moment.utc(r),o.recurring&&i.attrs.push(["data-recurring",l.md.utils.escapeHtml(o.recurring)]),e.push(i);var c=r.tz("Etc/UTC").format(l.md.options.discourse.datesEmailFormat||moment.defaultFormat);i.attrs.push(["data-email-preview",c+" UTC"]),s(e,l,r.utc().format(o.format))}function s(e,t,n){var s=void 0;s=new t.Token("text","",0),s.content=n,e.push(s),s=new t.Token("span_close","span",-1),e.push(s)}function l(e){e.whiteList(["span.discourse-local-date","span[data-*]","span[aria-label]"]),e.registerOptions(function(e,t){e.datesEmailFormat=t.discourse_local_dates_email_format,e.features["discourse-local-dates"]=!!t.discourse_local_dates_enabled}),e.registerPlugin(function(e){var t={matcher:/\[date(=.+?)\]/,onMatch:n};e.core.textPostProcess.ruler.push("discourse-local-dates",t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=l}),define("discourse/plugins/discourse-math/initializers/discourse-math",["exports","discourse/lib/plugin-api","discourse/lib/load-script"],function(e,t,n){"use strict";function s(e){if(!r){var t=["toMathML.js","Safe.js"];e.enable_accessibility&&t.push("[a11y]/accessibility-menu.js");var n={jax:["input/TeX","input/AsciiMath","input/MathML","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","autoload-all.js"]},extensions:t,showProcessingMessages:!1,root:Discourse.getURLWithCDN("/plugins/discourse-math/mathjax")};e.zoom_on_hover&&(n.menuSettings={zoom:"Hover"},n.MathEvents={hover:750}),window.MathJax=n,r=!0}}function l(e){return s(e),(0,n.default)("/plugins/discourse-math/mathjax/MathJax.2.7.5.js")}function i(e,t){var n=$(e);if(!n.data("applied-mathjax")){n.data("applied-mathjax",!0);var s=void 0,l=void 0;if(n.hasClass("math")){var i="DIV"===e.tagName?"div":"span",o="div"===i?"; mode=display":"";s=$("<"+i+' style="display: none;"><script type="math/tex'+o+'"><\/script></'+i+">"),l=s.children(),l.text(n.text()),n.after(s)}else n.hasClass("asciimath")&&(s=$('<span style="display: none;"><script type="math/asciimath"><\/script></span>'),l=s.children(),l.text(n.text()),n.after(s));Em.run.later(this,function(){window.MathJax.Hub.Queue(function(){e.parentElement&&null!==e.parentElement.offsetParent&&window.MathJax.Hub.Typeset(l[0],function(){n.remove(),s.show()})})},t?200:0)}}function o(e,t){if(e&&e.find){var n=void 0;if(n=t.enable_asciimath?e.find(".math, .asciimath"):e.find(".math"),n.length>0){var s=e.hasClass("d-editor-preview");l(t).then(function(){n.each(function(e,t){return i(t,s)})})}}}function a(e,t){e.decorateCooked(function(e){o(e,t)})}Object.defineProperty(e,"__esModule",{value:!0});var r=!1;e.default={name:"apply-math",initialize:function(e){var n=e.lookup("site-settings:main"),s={zoom_on_hover:n.discourse_math_zoom_on_hover,enable_accessibility:n.discourse_math_enable_accessibility,enable_asciimath:n.discourse_math_enable_asciimath};n.discourse_math_enabled&&(0,t.withPluginApi)("0.5",function(e){a(e,s)})}}}),define("discourse/plugins/discourse-math/lib/discourse-markdown/discourse-math",["exports"],function(e){"use strict";function t(e,t,n){return e!==t&&(!!n.utils.isWhiteSpace(e)||(!!n.utils.isMdAsciiPunct(e)||!!n.utils.isPunctChar(e)))}function n(e,n,s){var l=e.pos,i=e.posMax;if(n||e.src.charCodeAt(l)!==s||i<l+2)return!1;if(e.src.charCodeAt(l+1)===s)return!1;if(l>0){if(!t(e.src.charCodeAt(l-1),s,e.md))return!1}for(var o=void 0,a=l+1;a<i;a++){if(e.src.charCodeAt(a)===s&&92!==e.src.charCodeAt(a-1)){o=a;break}}if(!o)return!1;if(o+1<=i){var r=e.src.charCodeAt(o+1);if(r&&!t(r,s,e.md))return!1}var u=e.src.slice(l+1,o),c=e.push("html_raw","",0),p=e.md.utils.escapeHtml(u),d=36===s?"'math'":"'asciimath'";return c.content="<span class="+d+">"+p+"</span>",e.pos=o+1,!0}function s(e,t){return n(e,t,36)}function l(e,t){return n(e,t,37)}function i(e,t,n,s){if(36!==e.src.charCodeAt(t))return!1;if(t++,36!==e.src.charCodeAt(t))return!1;t++;for(var l=t;l<n;l++)if(!s.utils.isSpace(e.src.charCodeAt(l)))return!1;return!0}function o(e,t,n,s){if(!i(e,e.bMarks[t]+e.tShift[t],e.eMarks[t],e.md))return!1;if(s)return!0;for(var l=t,o=!1;!(++l>=n);)if(i(e,e.bMarks[l]+e.tShift[l],e.eMarks[l],e.md)){o=!0;break}var a=e.push("html_raw","",0),r=o?e.eMarks[l-1]:e.eMarks[l],u=e.src.slice(e.bMarks[t+1]+e.tShift[t+1],r),c=e.md.utils.escapeHtml(u);return a.content="<div class='math'>\n"+c+"\n</div>\n",e.line=o?l+1:l,!0}function a(e){if(e.markdownIt){var t=void 0;e.registerOptions(function(e,n){e.features.math=n.discourse_math_enabled,t=n.discourse_math_enable_asciimath}),e.registerPlugin(function(e){t&&e.inline.ruler.after("escape","asciimath",l),e.inline.ruler.after("escape","math",s),e.block.ruler.after("code","math",o,{alt:["paragraph","reference","blockquote","list"]})})}}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=a}),define("discourse/plugins/discourse-narrative-bot/initializers/new-user-narrative",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";function n(e){var t=e.container.lookup("message-bus:main"),n=e.getCurrentUser(),s=e.container.lookup("app-events:main");e.modifyClass("component:site-header",{didInsertElement:function(){this._super.apply(this,arguments),this.dispatch("header:search-context-trigger","header")}}),e.attachWidgetAction("header","headerSearchContextTrigger",function(){this.site.mobileView?this.state.skipSearchContext=!1:(this.state.contextEnabled=!0,this.state.searchContextType="topic")}),t&&n&&t.subscribe("/new_user_narrative/tutorial_search",function(){s.trigger("header:search-context-trigger")})}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"new-user-narratve",initialize:function(e){e.lookup("site-settings:main").discourse_narrative_bot_enabled&&(0,t.withPluginApi)("0.8.7",n)}}}),define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","discourse/lib/ajax","ember-addons/ember-computed-decorators"],function(e,t,n){"use strict";function s(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.bufferTime=e.keepAliveDuration=void 0;var l,i,o,a,r,u,c,p=e.keepAliveDuration=1e4,d=e.bufferTime=3e3;e.default=Ember.Component.extend((l=(0,n.on)("didInsertElement"),i=(0,n.observes)("action","post.id","topic.id"),o=(0,n.observes)("reply","title"),a=(0,n.on)("willDestroyElement"),r=(0,n.observes)("currentState"),u=(0,n.default)("presenceUsers","currentUser.id"),c={action:null,post:null,topic:null,reply:null,title:null,previousState:null,currentState:null,presenceUsers:null,channel:null,composerOpened:function(){this._lastPublish=new Date,Ember.run.once(this,"updateState")},composerStateChanged:function(){Ember.run.once(this,"updateState")},typing:function(){new Date-this._lastPublish>p&&this.publish({current:this.get("currentState")})},composerClosing:function(){this.publish({previous:this.get("currentState")}),Ember.run.cancel(this._pingTimer),Ember.run.cancel(this._clearTimer)},updateState:function(){var e=null,t=this.get("action");"reply"!==t&&"edit"!==t||(e={action:t},"reply"===t&&(e.topic_id=this.get("topic.id")),"edit"===t&&(e.post_id=this.get("post.id"))),this.set("previousState",this.get("currentState")),this.set("currentState",e)},currentStateChanged:function(){var e=this;this.get("channel")&&(this.messageBus.unsubscribe(this.get("channel")),this.set("channel",null)),this.clear(),["reply","edit"].includes(this.get("action"))&&this.publish({response_needed:!0,previous:this.get("previousState"),current:this.get("currentState")}).then(function(t){e.get("isDestroyed")||(e.set("presenceUsers",t.users),e.set("channel",t.messagebus_channel),t.messagebus_channel&&e.messageBus.subscribe(t.messagebus_channel,function(t){e.get("isDestroyed")||e.set("presenceUsers",t.users),e._clearTimer=Ember.run.debounce(e,"clear",p+d)},t.messagebus_id))})},clear:function(){this.get("isDestroyed")||this.set("presenceUsers",[])},publish:function(e){return this._lastPublish=new Date,this.currentUser.hide_profile_and_presence?Ember.RSVP.Promise.resolve():(0,t.ajax)("/presence/publish",{type:"POST",data:e})},users:function(e,t){return(e||[]).filter(function(e){return e.id!==t})},isReply:Ember.computed.equal("action","reply"),shouldDisplay:Ember.computed.gt("users.length",0)},s(c,"composerOpened",[l],Object.getOwnPropertyDescriptor(c,"composerOpened"),c),s(c,"composerStateChanged",[i],Object.getOwnPropertyDescriptor(c,"composerStateChanged"),c),s(c,"typing",[o],Object.getOwnPropertyDescriptor(c,"typing"),c),s(c,"composerClosing",[a],Object.getOwnPropertyDescriptor(c,"composerClosing"),c),s(c,"currentStateChanged",[r],Object.getOwnPropertyDescriptor(c,"currentStateChanged"),c),s(c,"users",[u],Object.getOwnPropertyDescriptor(c,"users"),c),c))}),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","ember-addons/ember-computed-decorators","discourse/plugins/discourse-presence/discourse/components/composer-presence-display"],function(e,t,n){"use strict";function s(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0});var l,i,o,a,r;e.default=Ember.Component.extend((l=(0,t.on)("didInsertElement"),i=(0,t.on)("willDestroyElement"),o=(0,t.default)("topicId"),a=(0,t.default)("presenceUsers","currentUser.id"),r={topicId:null,presenceUsers:null,clear:function(){this.get("isDestroyed")||this.set("presenceUsers",[])},_inserted:function(){var e=this;this.clear(),this.messageBus.subscribe(this.get("channel"),function(t){e.get("isDestroyed")||e.set("presenceUsers",t.users),e._clearTimer=Ember.run.debounce(e,"clear",n.keepAliveDuration+n.bufferTime)},-2)},_destroyed:function(){Ember.run.cancel(this._clearTimer),this.messageBus.unsubscribe(this.get("channel"))},channel:function(e){return"/presence/topic/"+e},users:function(e,t){return(e||[]).filter(function(e){return e.id!==t})},shouldDisplay:Ember.computed.gt("users.length",0)},s(r,"_inserted",[l],Object.getOwnPropertyDescriptor(r,"_inserted"),r),s(r,"_destroyed",[i],Object.getOwnPropertyDescriptor(r,"_destroyed"),r),s(r,"channel",[o],Object.getOwnPropertyDescriptor(r,"channel"),r),s(r,"users",[a],Object.getOwnPropertyDescriptor(r,"users"),r),r))}),Ember.TEMPLATES["javascripts/components/composer-presence-display"]=Ember.HTMLBars.template({id:null,
block:'{"symbols":["user"],"statements":[[4,"if",[[23,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","presence-users"],[9],[0,"\\n    "],[7,"div"],[11,"class","presence-avatars"],[9],[0,"\\n"],[4,"each",[[23,["users"]]],null,{"statements":[[0,"        "],[1,[27,"avatar",[[22,1,[]]],[["avatarTemplatePath","usernamePath","imageSize"],["avatar_template","username","small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[10],[0,"\\n    "],[7,"span"],[11,"class","presence-text"],[9],[0,"\\n      "],[7,"span"],[11,"class","description"],[9],[0,"\\n"],[4,"if",[[23,["isReply"]]],null,{"statements":[[1,[27,"i18n",["presence.replying"],null],false]],"parameters":[]},{"statements":[[1,[27,"i18n",["presence.editing"],null],false]],"parameters":[]}],[10],[10],[7,"span"],[11,"class","wave"],[9],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/composer-presence-display"}}),Ember.TEMPLATES["javascripts/components/topic-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[23,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","presence-users"],[9],[0,"\\n    "],[7,"div"],[11,"class","presence-avatars"],[9],[0,"\\n"],[4,"each",[[23,["users"]]],null,{"statements":[[0,"        "],[1,[27,"avatar",[[22,1,[]]],[["avatarTemplatePath","usernamePath","imageSize"],["avatar_template","username","small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[10],[0,"\\n    "],[7,"span"],[11,"class","presence-text"],[9],[0,"\\n      "],[7,"span"],[11,"class","description"],[9],[1,[27,"i18n",["presence.replying_to_topic"],[["count"],[[23,["users","length"]]]]],false],[10],[7,"span"],[11,"class","wave"],[9],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[7,"span"],[11,"class","dot"],[9],[0,"."],[10],[10],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/topic-presence-display"}}),Ember.TEMPLATES["javascripts/connectors/composer-fields/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[27,"composer-presence-display",null,[["action","post","topic","reply","title"],[[23,["model","action"]],[23,["model","post"]],[23,["model","topic"]],[23,["model","reply"]],[23,["model","title"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/composer-fields/presence"}}),define("discourse/plugins/discourse-presence/discourse/templates/connectors/composer-fields/presence",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,t){return t.siteSettings.presence_enabled}}}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[27,"topic-presence-display",null,[["topicId"],[[23,["model","id"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/topic-above-footer-buttons/presence"}}),define("discourse/plugins/discourse-presence/discourse/templates/connectors/topic-above-footer-buttons/presence",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,t){return t.siteSettings.presence_enabled}}}),Ember.TEMPLATES["javascripts/upgrade-header"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"unless",[[23,["versionCheck","upToDate"]]],null,{"statements":[[0,"  "],[1,[21,"upgrade-notice"],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/upgrade-header"}}),define("discourse/plugins/docker_manager/discourse/components/upgrade-notice",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend({tagName:"tr",href:function(){return Discourse.getURL("/admin/upgrade")}.property()})}),Ember.TEMPLATES["javascripts/components/upgrade-notice"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["currentUser","admin"]]],null,{"statements":[[0,"  "],[7,"th"],[11,"colspan","5"],[9],[1,[27,"i18n",["docker.upgrade"],null],false],[0," "],[7,"a"],[12,"href",[28,[[21,"href"]]]],[11,"data-auto-route","true"],[9],[1,[27,"i18n",["docker.perform_upgrade"],null],false],[10],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/upgrade-notice"}}),function(e){"use strict";function t(e,t){var n,s,l,i=e.data("width"),o=e.data("height"),a=e.data("ratio")?e.data("ratio"):t.default_ratio,r=e.data("youtube-id"),u=e.data("youtube-title"),c=[],p=e.data("parameters")||"";a=a.split(":"),"number"==typeof i&&"number"==typeof o?(e.width(i),n=o+"px"):"number"==typeof i?(e.width(i),n=i*a[1]/a[0]+"px"):(i=e.width(),0===i&&(i=e.parent().width()),n=a[1]/a[0]*100+"%"),c.push('<div class="ytp-thumbnail">'),c.push('<div class="ytp-large-play-button"'),i<=640&&c.push(' style="transform: scale(0.563888888888889);"'),c.push(">"),c.push("<svg>"),c.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),c.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),c.push("</svg>"),c.push("</div>"),c.push("</div>"),c.push('<div class="html5-info-bar">'),c.push('<div class="html5-title">'),c.push('<div class="html5-title-text-wrapper">'),c.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',r,'">'),void 0===u||null===u||""===u?c.push("youtube.com/watch?v="+r):c.push(u),c.push("</a>"),c.push("</div>"),c.push("</div>"),c.push("</div>"),e.css({"padding-bottom":n}).html(c.join("")),l=i>640?"maxresdefault.jpg":i>480?"sddefault.jpg":i>320?"hqdefault.jpg":i>120?"mqdefault.jpg":0===i?"hqdefault.jpg":"default.jpg",s=e.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",r,"/",l,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(n){n.preventDefault(),!e.hasClass("lazyYT-video-loaded")&&s.hasClass("lazyYT-image-loaded")&&e.html('<iframe src="//www.youtube.com/embed/'+r+"?autoplay=1&"+p+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),t.onPlay&&t.onPlay(n,e)})}e.fn.lazyYT=function(n){var s={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},l=e.extend(s,n);return this.each(function(){t(e(this).addClass(l.container_class),l)})}}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"apply-lazyYT",initialize:function(){(0,t.withPluginApi)("0.1",function(e){e.decorateCooked(function(t){0!==$(".lazyYT",t).length&&$(".lazyYT",t).lazyYT({onPlay:function(t,n){var s=parseInt(n.closest("article").data("post-id"));s&&e.preventCloak(s)}})})})}}}),define("discourse/plugins/poll/controllers/poll-ui-builder",["exports","ember-addons/ember-computed-decorators","discourse/models/input-validation"],function(e,t,n){"use strict";function s(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0});var l,i,o,a,r,u,c,p,d,m,f,h,v,b,g,y,w;e.default=Ember.Controller.extend((l=(0,t.default)("regularPollType","numberPollType","multiplePollType"),i=(0,t.default)("alwaysPollResult","votePollResult","closedPollResult"),o=(0,t.default)("pollType","regularPollType"),a=(0,t.default)("pollType","pollOptionsCount","multiplePollType"),r=(0,t.default)("pollType","numberPollType"),u=(0,t.default)("isRegular"),c=(0,t.default)("pollOptions"),p=(0,t.observes)("isMultiple","isNumber","pollOptionsCount"),d=(0,t.default)("isRegular","isMultiple","isNumber","pollOptionsCount"),m=(0,t.default)("isRegular","isMultiple","isNumber","pollOptionsCount","pollMin","pollStep"),f=(0,t.default)("isNumber","pollMax"),h=(0,t.default)("isNumber","showMinMax","pollType","pollResult","publicPoll","pollOptions","pollMin","pollMax","pollStep","autoClose","date","time"),v=(0,t.default)("pollOptionsCount","isRegular","isMultiple","isNumber","pollMin","pollMax"),b=(0,t.default)("pollMin","pollMax"),g=(0,t.default)("pollStep"),y=(0,t.default)("disableInsert"),w={regularPollType:"regular",numberPollType:"number",multiplePollType:"multiple",alwaysPollResult:"always",votePollResult:"on_vote",closedPollResult:"on_close",init:function(){this._super.apply(this,arguments),this._setupPoll()},pollTypes:function(e,t,n){return[{name:I18n.t("poll.ui_builder.poll_type.regular"),value:e},{name:I18n.t("poll.ui_builder.poll_type.number"),value:t},{name:I18n.t("poll.ui_builder.poll_type.multiple"),value:n}]},pollResults:function(e,t,n){return[{name:I18n.t("poll.ui_builder.poll_result.always"),value:e},{name:I18n.t("poll.ui_builder.poll_result.vote"),value:t},{name:I18n.t("poll.ui_builder.poll_result.closed"),value:n}]},isRegular:function(e,t){return e===t},isMultiple:function(e,t,n){return e===n&&t>0},isNumber:function(e,t){return e===t},showMinMax:function(e){return!e},pollOptionsCount:function(e){if(0===e.length)return 0;var t=0;return e.split("\n").forEach(function(e){0!==e.length&&(t+=1)}),t},_setPollMax:function(){var e=this.get("isMultiple"),t=this.get("isNumber");(e||t)&&(e?this.set("pollMax",this.get("pollOptionsCount")):t&&this.set("pollMax",this.siteSettings.poll_maximum_options))},pollMinOptions:function(e,t,n,s){if(!e)return t?this._comboboxOptions(1,s+1):n?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0},pollMaxOptions:function(e,t,n,s,l,i){if(!e){var o=parseInt(l)||1;if(t)return this._comboboxOptions(o+1,s+1);if(n){var a=parseInt(i,10);return a<1&&(a=1),this._comboboxOptions(o+1,o+this.siteSettings.poll_maximum_options*a)}}},pollStepOptions:function(e,t){if(e)return this._comboboxOptions(1,(parseInt(t)||1)+1)},pollOutput:function(e,t,n,s,l,i,o,a,r,u,c,p){var d="[poll",m="",f=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);f&&(d+=" name=poll"+(f.length+1));var h=r;if(h<1&&(h=1),n&&(d+=" type="+n),s&&(d+=" results="+s),o&&t&&(d+=" min="+o),a&&(d+=" max="+a),e&&(d+=" step="+h),l&&(d+=" public=true"),u){var v=moment(c+" "+p,"YYYY-MM-DD HH:mm").toISOString();v&&(d+=" close="+v)}return d+="]",m+=d+"\n",i.length>0&&!e&&i.split("\n").forEach(function(e){0!==e.length&&(m+="* "+e+"\n")}),m+="[/poll]"},disableInsert:function(e,t,n,s,l,i){return t&&e<2||n&&e<l&&l>=i||!s&&e<2},minMaxValueValidation:function(e,t){var s={ok:!0};return e>=t&&(s={failed:!0,reason:I18n.t("poll.ui_builder.help.invalid_values")}),n.default.create(s)},minStepValueValidation:function(e){var t={ok:!0};return e<1&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.min_step_value")}),n.default.create(t)},minNumOfOptionsValidation:function(e){var t={ok:!0};return e&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),n.default.create(t)},_comboboxOptions:function(e,t){return _.range(e,t).map(function(e){return{value:e,name:e}})},_setupPoll:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1,autoClose:!1,date:moment().add(1,"day").format("YYYY-MM-DD"),time:moment().add(1,"hour").format("HH:mm")})},actions:{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}},s(w,"pollTypes",[l],Object.getOwnPropertyDescriptor(w,"pollTypes"),w),s(w,"pollResults",[i],Object.getOwnPropertyDescriptor(w,"pollResults"),w),s(w,"isRegular",[o],Object.getOwnPropertyDescriptor(w,"isRegular"),w),s(w,"isMultiple",[a],Object.getOwnPropertyDescriptor(w,"isMultiple"),w),s(w,"isNumber",[r],Object.getOwnPropertyDescriptor(w,"isNumber"),w),s(w,"showMinMax",[u],Object.getOwnPropertyDescriptor(w,"showMinMax"),w),s(w,"pollOptionsCount",[c],Object.getOwnPropertyDescriptor(w,"pollOptionsCount"),w),s(w,"_setPollMax",[p],Object.getOwnPropertyDescriptor(w,"_setPollMax"),w),s(w,"pollMinOptions",[d],Object.getOwnPropertyDescriptor(w,"pollMinOptions"),w),s(w,"pollMaxOptions",[m],Object.getOwnPropertyDescriptor(w,"pollMaxOptions"),w),s(w,"pollStepOptions",[f],Object.getOwnPropertyDescriptor(w,"pollStepOptions"),w),s(w,"pollOutput",[h],Object.getOwnPropertyDescriptor(w,"pollOutput"),w),s(w,"disableInsert",[v],Object.getOwnPropertyDescriptor(w,"disableInsert"),w),s(w,"minMaxValueValidation",[b],Object.getOwnPropertyDescriptor(w,"minMaxValueValidation"),w),s(w,"minStepValueValidation",[g],Object.getOwnPropertyDescriptor(w,"minStepValueValidation"),w),s(w,"minNumOfOptionsValidation",[y],Object.getOwnPropertyDescriptor(w,"minNumOfOptionsValidation"),w),w))}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],{"statements":[[0,"  "],[7,"form"],[11,"class","poll-ui-builder-form form-horizontal"],[9],[0,"\\n    "],[7,"div"],[11,"class","input-group poll-select"],[9],[0,"\\n      "],[7,"label"],[11,"class","input-group-label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_type.label"],null],false],[10],[0,"\\n      "],[1,[27,"combo-box",null,[["content","value","allowInitialValueMutation","valueAttribute"],[[23,["pollTypes"]],[23,["pollType"]],true,"value"]]],false],[0,"\\n    "],[10],[0,"\\n\\n    "],[7,"div"],[11,"class","input-group poll-select"],[9],[0,"\\n      "],[7,"label"],[11,"class","input-group-label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_result.label"],null],false],[10],[0,"\\n      "],[1,[27,"combo-box",null,[["content","value","allowInitialValueMutation","valueAttribute"],[[23,["pollResults"]],[23,["pollResult"]],true,"value"]]],false],[0,"\\n    "],[10],[0,"\\n\\n\\n"],[4,"if",[[23,["showMinMax"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n        "],[1,[27,"input-tip",null,[["validation"],[[23,["minMaxValueValidation"]]]]],false],[0,"\\n        "],[7,"label"],[11,"class","input-group-label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_config.min"],null],false],[10],[0,"\\n        "],[1,[27,"input",null,[["type","value","valueAttribute","class"],["number",[23,["pollMin"]],"value","poll-options-min"]]],false],[0,"\\n      "],[10],[0,"\\n\\n\\n      "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n        "],[7,"label"],[11,"class","input-group-label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_config.max"],null],false],[10],[0,"\\n        "],[1,[27,"input",null,[["type","value","valueAttribute","class"],["number",[23,["pollMax"]],"value","poll-options-max"]]],false],[0,"\\n      "],[10],[0,"\\n\\n"],[4,"if",[[23,["isNumber"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n          "],[7,"label"],[11,"class","input-group-label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_config.step"],null],false],[10],[0,"\\n          "],[1,[27,"input",null,[["type","value","valueAttribute","min","class"],["number",[23,["pollStep"]],"value","1","poll-options-step"]]],false],[0,"\\n          "],[1,[27,"input-tip",null,[["validation"],[[23,["minStepValueValidation"]]]]],false],[0,"\\n        "],[10],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[4,"unless",[[23,["isNumber"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","input-group poll-textarea"],[9],[0,"\\n        "],[7,"label"],[9],[1,[27,"i18n",["poll.ui_builder.poll_options.label"],null],false],[10],[0,"\\n        "],[1,[27,"textarea",null,[["value","autocomplete"],[[23,["pollOptions"]],"discourse"]]],false],[0,"\\n        "],[1,[27,"input-tip",null,[["validation"],[[23,["minNumOfOptionsValidation"]]]]],false],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n    "],[7,"div"],[11,"class","input-group poll-checkbox"],[9],[0,"\\n      "],[7,"label"],[9],[0,"\\n        "],[1,[27,"input",null,[["type","checked"],["checkbox",[23,["publicPoll"]]]]],false],[0,"\\n        "],[1,[27,"i18n",["poll.ui_builder.poll_public.label"],null],false],[0,"\\n      "],[10],[0,"\\n    "],[10],[0,"\\n\\n    "],[7,"div"],[11,"class","input-group poll-checkbox"],[9],[0,"\\n      "],[7,"label"],[9],[0,"\\n        "],[1,[27,"input",null,[["type","checked"],["checkbox",[23,["autoClose"]]]]],false],[0,"\\n        "],[1,[27,"i18n",["poll.ui_builder.automatic_close.label"],null],false],[0,"\\n      "],[10],[0,"\\n    "],[10],[0,"\\n\\n"],[4,"if",[[23,["autoClose"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","input-group"],[9],[0,"\\n        "],[1,[27,"date-picker-future",null,[["value","containerId"],[[23,["date"]],"date-container"]]],false],[0,"\\n        "],[1,[27,"input",null,[["type","value"],["time",[23,["time"]]]]],false],[0,"\\n        "],[7,"div"],[11,"id","date-container"],[9],[10],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null],[0,"  "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div"],[11,"class","modal-footer"],[9],[0,"\\n  "],[1,[27,"d-button",null,[["action","icon","class","label","disabled"],[[27,"action",[[22,0,[]],"insertPoll"],null],"chart-bar","btn-primary","poll.ui_builder.insert",[23,["disableInsert"]]]]],false],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["exports","discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse/lib/show-modal"],function(e,t,n,s){"use strict";function l(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}function i(e){var t,i;e.modifyClass("controller:composer",(t=(0,n.default)("siteSettings.poll_enabled","siteSettings.poll_minimum_trust_level_to_create","model.topic.pm_with_non_human_user"),i={canBuildPoll:function(e,t,n){return e&&(n||this.currentUser&&(this.currentUser.staff||this.currentUser.trust_level>=t))},actions:{showPollBuilder:function(){(0,s.default)("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}},l(i,"canBuildPoll",[t],Object.getOwnPropertyDescriptor(i,"canBuildPoll"),i),i)),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"chart-bar",label:"poll.ui_builder.title",condition:"canBuildPoll"}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"add-poll-ui-builder",initialize:function(){(0,t.withPluginApi)("0.8.7",i)}}}),define("discourse/plugins/poll/initializers/extend-for-poll",["exports","discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue"],function(e,t,n,s,l){"use strict";function i(e,t,n,s,l){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,s){return s(e,t,n)||n},i),l&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(l):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}function o(e){function t(){p.forEach(function(e){return e.queueRerender()})}function o(n,s){var i=$(".poll",n);if(i.length&&s){var o=s.getModel();e.preventCloak(o.id);var a=o.get("polls_votes")||{};o.pollsChanged();var r=o.get("pollsObject");r&&(d=d||setInterval(t,3e4),i.each(function(e,t){var n=$(t),s=n.data("poll-name"),i=r[s];if(i){var u=new l.default("discourse-poll",c,{id:s+"-"+o.id,post:o,poll:i,vote:a[s]||[]});u.appendTo(t),p.push(u)}}))}}function a(){d&&(clearInterval(d),d=null),p.forEach(function(e){return e.cleanUp()}),p=[]}var r,u,c=(0,s.getRegister)(e);e.modifyClass("controller:topic",{subscribe:function(){var e=this;this._super.apply(this,arguments),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var n=e.get("model.postStream").findLoadedPost(t.post_id);n&&n.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super.apply(this,arguments)}});var p=[],d=null;e.modifyClass("model:post",(r=(0,n.observes)("polls"),u={_polls:null,pollsObject:null,pollsChanged:function(){var e=this,n=this.get("polls");n&&(this._polls=this._polls||{},n.forEach(function(t){e._polls[t.name]?e._polls[t.name].setProperties(t):e._polls[t.name]=Ember.Object.create(t)}),this.set("pollsObject",this._polls),t())}},i(u,"pollsChanged",[r],Object.getOwnPropertyDescriptor(u,"pollsChanged"),u),u)),e.includePostAttributes("polls","polls_votes"),e.decorateCooked(o,{onlyStream:!0}),e.cleanupStream(a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"extend-for-poll",initialize:function(){(0,t.withPluginApi)("0.8.7",o)}}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["exports"],function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function n(e,n,s){var l=e.indexOf(n),i=e[l].level;for(e.splice.apply(e,[l,1].concat(t(s))),s[0].map=n.map;l<e.length;l++){var o=e[l].nesting;o<0&&i--,e[l].level=i,o>0&&i++}}function s(e,t){for(var n=e.length-1,s=[],l=[];e[n]!==t;n--){if(0===n)return;var i=e[n];if(0===i.level&&"ol"!==i.tag&&"ul"!==i.tag)return;if(1===i.level&&1===i.nesting){if("li"!==i.tag)return;s.push([i,l.reverse().join(" ")])}1===i.level&&1===i.nesting&&"li"===i.tag?l=[]:"text"!==i.type&&"inline"!==i.type||l.push(i.content)}return s.reverse()}function l(e,t){e.push("text","",0).content="[/"+t+"]"}function i(e){e.registerOptions(function(e,t){e.features.poll=!!t.poll_enabled,e.pollMaximumOptions=t.poll_maximum_options}),e.registerPlugin(function(e){e.block.bbcode.ruler.push("poll",y)})}function o(e){e.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","span.info-label","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),i(e)}function a(e,t){var n=e[0],s=e[1],l=e[2],i=e[3];n=u(n,s,l,i,t[0],7,-680876936),i=u(i,n,s,l,t[1],12,-389564586),l=u(l,i,n,s,t[2],17,606105819),s=u(s,l,i,n,t[3],22,-1044525330),n=u(n,s,l,i,t[4],7,-176418897),i=u(i,n,s,l,t[5],12,1200080426),l=u(l,i,n,s,t[6],17,-1473231341),s=u(s,l,i,n,t[7],22,-45705983),n=u(n,s,l,i,t[8],7,1770035416),i=u(i,n,s,l,t[9],12,-1958414417),l=u(l,i,n,s,t[10],17,-42063),s=u(s,l,i,n,t[11],22,-1990404162),n=u(n,s,l,i,t[12],7,1804603682),i=u(i,n,s,l,t[13],12,-40341101),l=u(l,i,n,s,t[14],17,-1502002290),s=u(s,l,i,n,t[15],22,1236535329),n=c(n,s,l,i,t[1],5,-165796510),i=c(i,n,s,l,t[6],9,-1069501632),l=c(l,i,n,s,t[11],14,643717713),s=c(s,l,i,n,t[0],20,-373897302),n=c(n,s,l,i,t[5],5,-701558691),i=c(i,n,s,l,t[10],9,38016083),l=c(l,i,n,s,t[15],14,-660478335),s=c(s,l,i,n,t[4],20,-405537848),n=c(n,s,l,i,t[9],5,568446438),i=c(i,n,s,l,t[14],9,-1019803690),l=c(l,i,n,s,t[3],14,-187363961),s=c(s,l,i,n,t[8],20,1163531501),n=c(n,s,l,i,t[13],5,-1444681467),i=c(i,n,s,l,t[2],9,-51403784),l=c(l,i,n,s,t[7],14,1735328473),s=c(s,l,i,n,t[12],20,-1926607734),n=p(n,s,l,i,t[5],4,-378558),i=p(i,n,s,l,t[8],11,-2022574463),l=p(l,i,n,s,t[11],16,1839030562),s=p(s,l,i,n,t[14],23,-35309556),n=p(n,s,l,i,t[1],4,-1530992060),i=p(i,n,s,l,t[4],11,1272893353),l=p(l,i,n,s,t[7],16,-155497632),s=p(s,l,i,n,t[10],23,-1094730640),n=p(n,s,l,i,t[13],4,681279174),i=p(i,n,s,l,t[0],11,-358537222),l=p(l,i,n,s,t[3],16,-722521979),s=p(s,l,i,n,t[6],23,76029189),n=p(n,s,l,i,t[9],4,-640364487),i=p(i,n,s,l,t[12],11,-421815835),l=p(l,i,n,s,t[15],16,530742520),s=p(s,l,i,n,t[2],23,-995338651),n=d(n,s,l,i,t[0],6,-198630844),i=d(i,n,s,l,t[7],10,1126891415),l=d(l,i,n,s,t[14],15,-1416354905),s=d(s,l,i,n,t[5],21,-57434055),n=d(n,s,l,i,t[12],6,1700485571),i=d(i,n,s,l,t[3],10,-1894986606),l=d(l,i,n,s,t[10],15,-1051523),s=d(s,l,i,n,t[1],21,-2054922799),n=d(n,s,l,i,t[8],6,1873313359),i=d(i,n,s,l,t[15],10,-30611744),l=d(l,i,n,s,t[6],15,-1560198380),s=d(s,l,i,n,t[13],21,1309151649),n=d(n,s,l,i,t[4],6,-145523070),i=d(i,n,s,l,t[11],10,-1120210379),l=d(l,i,n,s,t[2],15,718787259),s=d(s,l,i,n,t[9],21,-343485551),e[0]=b(n,e[0]),e[1]=b(s,e[1]),e[2]=b(l,e[2]),e[3]=b(i,e[3])}function r(e,t,n,s,l,i){return t=b(b(t,e),b(s,i)),b(t<<l|t>>>32-l,n)}function u(e,t,n,s,l,i,o){return r(t&n|~t&s,e,t,l,i,o)}function c(e,t,n,s,l,i,o){return r(t&s|n&~s,e,t,l,i,o)}function p(e,t,n,s,l,i,o){return r(t^n^s,e,t,l,i,o)}function d(e,t,n,s,l,i,o){return r(n^(t|~s),e,t,l,i,o)}function m(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e)));var t,n=e.length,s=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)a(s,f(e.substring(t-64,t)));e=e.substring(t-64);var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)l[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(l[t>>2]|=128<<(t%4<<3),t>55)for(a(s,l),t=0;t<16;t++)l[t]=0;return l[14]=8*n,a(s,l),s}function f(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function h(e){for(var t="",n=0;n<4;n++)t+=w[e>>8*n+4&15]+w[e>>8*n&15];return t}function v(e){for(var t=0;t<e.length;t++)e[t]=h(e[t]);return e.join("")}function b(e,t){return e+t&4294967295}function g(e){return v(m(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=o;var _=["close","max","min","name","order","public","results","status","step","type"],y={tag:"poll",before:function(e,t,n){var s=e.push("text","",0);s.content=n,s.bbcode_attrs=t.attrs,s.bbcode_type="poll_open"},after:function(e,t,i){var o=s(e.tokens,t);if(!o)return l(e,i);var a=t.bbcode_attrs,r=[["class","poll"]];a.status||r.push(["data-poll-status","open"]),_.forEach(function(e){a[e]&&r.push(["data-poll-"+e,a[e]])}),a.name||r.push(["data-poll-name","poll"]);var u=parseInt(a.min,10),c=parseInt(a.max,10),p=parseInt(a.step,10);p<1&&(p=1);var d=[],m=new e.Token("poll_open","div",1);if(m.block=!0,m.attrs=r,d.push(m),m=new e.Token("poll_open","div",1),m.block=!0,d.push(m),m=new e.Token("poll_open","div",1),m.attrs=[["class","poll-container"]],d.push(m),"number"===a.type){if(isNaN(u)&&(u=1),isNaN(c)&&(c=e.md.options.discourse.pollMaximumOptions),isNaN(p)&&(p=1),o.length>0)return l(e,i);m=new e.Token("bullet_list_open","ul",1),d.push(m);for(var f=u;f<=c;f+=p)m=new e.Token("list_item_open","li",1),o.push([m,String(f)]),d.push(m),m=new e.Token("text","",0),m.content=String(f),d.push(m),m=new e.Token("list_item_close","li",-1),d.push(m);m=new e.Token("bullet_item_close","",-1),d.push(m)}for(var h=0;h<o.length;h++){m=o[h][0];var v=o[h][1];m.attrs=m.attrs||[];var b=g(JSON.stringify([v]));m.attrs.push(["data-poll-option-id",b])}n(e.tokens,t,d),e.level=e.tokens[e.tokens.length-1].level,e.push("poll_close","div",-1),m=e.push("poll_open","div",1),m.attrs=[["class","poll-info"]],e.push("paragraph_open","p",1),m=e.push("span_open","span",1),m.block=!1,m.attrs=[["class","info-number"]],m=e.push("text","",0),m.content="0",e.push("span_close","span",-1),m=e.push("span_open","span",1),m.block=!1,m.attrs=[["class","info-label"]],m=e.push("text","",0),m.content=I18n.t("poll.voters",{count:0}),e.push("span_close","span",-1),e.push("paragraph_close","p",-1),e.push("poll_close","div",-1),e.push("poll_close","div",-1),e.push("poll_close","div",-1)}},w="0123456789abcdef".split("")}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict";function t(e){return 100===e.map(function(e){return Math.floor(e)}).reduce(function(e,t){return e+t})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){for(var n=e.map(function(e){return e%1}),s=Math.ceil(n.reduce(function(e,t){return e+t})),l=0,i=n.length;l<s&&l<i;l++){for(var o=0,a=0,r=0;r<n.length;r++)n[r]>o&&(a=r,o=n[r]);if(++e[a],n[a]=0,t(e))break}return e.map(function(e){return Math.floor(e)})}}),define("discourse/plugins/poll/widgets/discourse-poll",["exports","discourse/widgets/widget","virtual-dom","discourse-common/lib/icon-library","discourse/widgets/raw-html","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","discourse/lib/formatter","discourse/lib/url"],function(e,t,n,s,l,i,o,a,r,u,c,p){"use strict";function d(e){return new l.default({html:"<span>"+e.html+"</span>"})}function m(e){return new l.default({html:'<span class="info-text">'+e+"</span>"})}function f(e){return(0,i.ajax)("/polls/voters.json",{data:e}).catch(function(e){e?(0,o.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}Object.defineProperty(e,"__esModule",{value:!0}),(0,t.createWidget)("discourse-poll-option",{tagName:"li",buildAttributes:function(e){return{"data-poll-option-id":e.option.id}},html:function(e){var t=[],n=e.option,l=e.vote,i=l.includes(n.id);return e.isMultiple?t.push((0,s.iconNode)(i?"far-check-square":"far-square")):t.push((0,s.iconNode)(i?"circle":"far-circle")),t.push(" "),t.push(d(n)),t},click:function(e){0===$(e.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),(0,t.createWidget)("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(e){return"load-more-"+e.optionId},defaultState:function(){return{loading:!1}},html:function(e,t){return t.loading?(0,n.h)("div.spinner.small"):(0,n.h)("a",(0,s.iconNode)("chevron-down"))},click:function(){var e=this.state;if(!e.loading)return e.loading=!0,this.sendWidgetAction("loadMore").finally(function(){return e.loading=!1})}}),(0,t.createWidget)("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(e){return"poll-voters-"+e.optionId},defaultState:function(){return{loaded:"new",voters:[],page:1}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;if("loading"!==n.loaded)return n.loaded="loading",f({post_id:t.postId,poll_name:t.pollName,option_id:t.optionId,page:n.page}).then(function(s){n.loaded="loaded",n.page+=1;var l="number"===t.pollType?s.voters:s.voters[t.optionId],i=new Set(n.voters.map(function(e){return e.username}));l.forEach(function(e){i.has(e.username)||(i.add(e.username),n.voters.push(e))}),
e.scheduleRerender()})},loadMore:function(){return this.fetchVoters()},html:function(e,t){var s=this;e.voters&&"new"===t.loaded&&(t.voters=e.voters);var l=t.voters.map(function(e){return(0,n.h)("li",[(0,r.avatarFor)("tiny",{username:e.username,url:s.site.mobileView?(0,p.userPath)(e.username):void 0,template:e.avatar_template})," "])});return t.voters.length<e.totalVotes&&l.push(this.attach("discourse-poll-load-more",e)),(0,n.h)("div.poll-voters",l)}}),(0,t.createWidget)("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(e){return"poll-standard-results-"+e.id},defaultState:function(){return{loaded:!1}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;return f({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(t){n.voters=t.voters,e.scheduleRerender()})},html:function(e,t){var s=this,l=e.poll,i=l.get("options");if(i){var o=l.get("voters"),r=l.get("public"),u=_.clone(i).sort(function(e,t){return e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1});r&&!t.loaded&&(t.voters=l.get("preloaded_voters"),t.loaded=!0);var c=0===o?Array(u.length).fill(0):u.map(function(e){return 100*e.votes/o}),p=e.isMultiple?c.map(Math.floor):(0,a.default)(c);return u.map(function(i,o){var a=[],u=p[o].toString(),c=(e.vote||[]).includes(i.id);return a.push((0,n.h)("div.option",(0,n.h)("p",[(0,n.h)("span.percentage",u+"%"),d(i)]))),a.push((0,n.h)("div.bar-back",(0,n.h)("div.bar",{attributes:{style:"width:"+u+"%"}}))),r&&a.push(s.attach("discourse-poll-voters",{postId:e.post.id,optionId:i.id,pollName:l.get("name"),totalVotes:i.votes,voters:t.voters&&t.voters[i.id]||[]})),(0,n.h)("li",{className:c?"chosen":""},a)})}}}),(0,t.createWidget)("discourse-poll-number-results",{buildKey:function(e){return"poll-number-results-"+e.id},defaultState:function(){return{loaded:!1}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;return f({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(t){n.voters=t.voters,e.scheduleRerender()})},html:function(e,t){var s=e.poll,i=s.get("options").reduce(function(e,t){return e+parseInt(t.html,10)*parseInt(t.votes,10)},0),o=s.get("voters"),a=0===o?0:(0,u.default)(i/o,-2),r=I18n.t("poll.average_rating",{average:a}),c=[(0,n.h)("div.poll-results-number-rating",new l.default({html:"<span>"+r+"</span>"}))];return s.get("public")&&(t.loaded||(t.voters=s.get("preloaded_voters"),t.loaded=!0),c.push(this.attach("discourse-poll-voters",{totalVotes:s.get("voters"),voters:t.voters||[],postId:e.post.id,pollName:s.get("name"),pollType:s.get("type")}))),c}}),(0,t.createWidget)("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var t=this,s=e.poll,l=s.get("options");if(e.showResults){var i="number"===s.get("type")?"number":"standard";return this.attach("discourse-poll-"+i+"-results",e)}if(l)return(0,n.h)("ul",l.map(function(n){return t.attach("discourse-poll-option",{option:n,isMultiple:e.isMultiple,vote:e.vote})}))}}),(0,t.createWidget)("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(e,t,n){if(t>0)if(e===t){if(e>1)return I18n.t("poll.multiple.help.x_options",{count:e})}else{if(e>1)return t<n?I18n.t("poll.multiple.help.between_min_and_max_options",{min:e,max:t}):I18n.t("poll.multiple.help.at_least_min_options",{count:e});if(t<=n)return I18n.t("poll.multiple.help.up_to_max_options",{count:t})}},html:function(e){var t=e.poll,s=t.get("voters"),l=[(0,n.h)("p",[(0,n.h)("span.info-number",s.toString()),(0,n.h)("span.info-label",I18n.t("poll.voters",{count:s}))])];if(e.isMultiple)if(e.showResults||e.isClosed){var i=t.get("options").reduce(function(e,t){return e+parseInt(t.votes,10)},0);l.push((0,n.h)("p",[(0,n.h)("span.info-number",i.toString()),(0,n.h)("span.info-label",I18n.t("poll.total_votes",{count:i}))]))}else{var o=this.multipleHelpText(e.min,e.max,t.get("options.length"));o&&l.push(m(o))}return e.isClosed||e.showResults||!t.get("public")||l.push(m(I18n.t("poll.public.title"))),l}}),(0,t.createWidget)("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(e){var t=[],n=e.poll,s=e.post,i=s.get("topic.archived"),o=e.isClosed,a=o||i;if(e.isMultiple&&!a){var r=!e.canCastVotes;t.push(this.attach("button",{className:"btn cast-votes "+(r?"btn-default":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:r,action:"castVotes"})),t.push(" ")}if(e.showResults||a?t.push(this.attach("button",{className:"btn btn-default toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"far-eye-slash",disabled:a,action:"toggleResults"})):"on_vote"!==n.get("results")||e.hasVoted?"on_close"!==n.get("results")||o?t.push(this.attach("button",{className:"btn btn-default toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"far-eye",disabled:0===n.get("voters"),action:"toggleResults"})):t.push(m(I18n.t("poll.results.closed.title"))):t.push(m(I18n.t("poll.results.vote.title"))),n.get("close")){var u=moment.utc(n.get("close"));if(u.isValid()){var p=u.format("LLL"),d=void 0;if(e.isAutomaticallyClosed){var f=(0,c.relativeAge)(u.toDate(),{addAgo:!0});d=I18n.t("poll.automatic_close.age",{age:f})}else{var h=moment().to(u.local(),!0);d=I18n.t("poll.automatic_close.closes_in",{timeLeft:h})}t.push(new l.default({html:'<span class="info-text" title="'+p+'">'+d+"</span>"}))}}return!this.currentUser||this.currentUser.get("id")!==s.get("user_id")&&!this.currentUser.get("staff")||i||(o?e.isAutomaticallyClosed||t.push(this.attach("button",{className:"btn btn-default toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):t.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),t}}),e.default=(0,t.createWidget)("discourse-poll",{tagName:"div.poll",buildKey:function(e){return"poll-"+e.id},buildAttributes:function(e){return{"data-poll-name":e.poll.get("name"),"data-poll-type":e.poll.get("type")}},defaultState:function(e){var t=e.post,n=e.poll;return{loading:!1,showResults:t.get("topic.archived")||this.isClosed()||"on_close"!==n.get("results")&&this.hasVoted()}},html:function(e,t){var s=t.showResults||e.post.get("topic.archived")||this.isClosed(),l=jQuery.extend({},e,{canCastVotes:this.canCastVotes(),hasVoted:this.hasVoted(),isAutomaticallyClosed:this.isAutomaticallyClosed(),isClosed:this.isClosed(),isMultiple:this.isMultiple(),max:this.max(),min:this.min(),showResults:s});return(0,n.h)("div",[this.attach("discourse-poll-container",l),this.attach("discourse-poll-info",l),this.attach("discourse-poll-buttons",l)])},min:function(){var e=parseInt(this.attrs.poll.get("min"),10);return(isNaN(e)||e<0)&&(e=0),e},max:function(){var e=parseInt(this.attrs.poll.get("max"),10),t=this.attrs.poll.get("options.length");return(isNaN(e)||e>t)&&(e=t),e},isAutomaticallyClosed:function(){var e=this.attrs.poll;return e.get("close")&&moment.utc(e.get("close"))<=moment()},isClosed:function(){return"closed"===this.attrs.poll.get("status")||this.isAutomaticallyClosed()},isMultiple:function(){return"multiple"===this.attrs.poll.get("type")},hasVoted:function(){var e=this.attrs.vote;return e&&e.length>0},canCastVotes:function(){var e=this.state,t=this.attrs;if(this.isClosed()||e.showResults||e.loading)return!1;var n=t.vote.length;return this.isMultiple()?n>=this.min()&&n<=this.max():n>0},toggleStatus:function(){var e=this,t=this.state,n=this.attrs,s=n.post,l=n.poll;this.isAutomaticallyClosed()||bootbox.confirm(I18n.t(this.isClosed()?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(n){if(n){t.loading=!0;var a=e.isClosed()?"open":"closed";(0,i.ajax)("/polls/toggle_status",{type:"PUT",data:{post_id:s.get("id"),poll_name:l.get("name"),status:a}}).then(function(){l.set("status",a),"on_close"===l.get("results")&&(t.showResults="closed"===a),e.scheduleRerender()}).catch(function(e){e?(0,o.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_toggling_status"))}).finally(function(){t.loading=!1})}})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){this.register.lookup("route:application").send("showLogin")},toggleOption:function(e){var t=this.attrs;if(!this.isClosed()){if(!this.currentUser)return this.showLogin();var n=t.vote,s=n.indexOf(e.id);return this.isMultiple()||(n.length=0),-1!==s?n.splice(s,1):n.push(e.id),this.isMultiple()?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var e=this.attrs,t=this.state;return t.loading=!0,(0,i.ajax)("/polls/vote",{type:"PUT",data:{post_id:e.post.id,poll_name:e.poll.get("name"),options:e.vote}}).then(function(n){var s=n.poll;e.poll.setProperties(s),"on_close"!==e.poll.get("results")&&(t.showResults=!0)}).catch(function(e){e?(0,o.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_casting_votes"))}).finally(function(){t.loading=!1})}}})});
//# sourceMappingURL=/assets/plugin-a415703842591d54bdb005fbf0a1067d13c754a474936b1ad63f22653402981f.js.map